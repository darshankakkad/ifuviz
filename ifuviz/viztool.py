import numpy as np
import matplotlib.pyplot as plt

def initiate_viztool(cube, wl_array):
    Nz, Ny, Nx = np.shape(cube)
    cube[np.isnan(cube)] = 0
    collapse_img = np.sum(cube, axis=0)

    fig, (ax0, ax1) = plt.subplots(2, 1, figsize=(8, 9.2), gridspec_kw={"height_ratios": [2, 1]})
    img = ax0.imshow(collapse_img, origin='lower', cmap='hot')

    spec_line, = ax1.plot([], [], label='Data', color='grey')
    #model_line, = ax1.plot([], [], label='Model', color='red')

    def onclick(event):
        if event.inaxes == ax0:
            i, j = int(event.xdata), int(event.ydata)
            spectrum = cube[:, j, i]
            #model_spec = model_cube[:, j, i]
            spec_line.set_data(wl_array, spectrum)
            #model_line.set_data(wl_array, model_spec)
            ax1.margins(x=0)
            fig.canvas.draw_idle()

    ax1.set_title("Click on a pixel to view the spectrum")
    ax1.set_xlabel("Wavelength")
    ax1.set_ylabel("Flux")
    ax1.legend()

    fig.canvas.mpl_connect('button_press_event', onclick)
    plt.tight_layout()
    plt.show()




































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































import numpy as np
import matplotlib.pyplot as plt

def launch_viewer(cube, model_cube, wavelength):
    ny, nx = cube.shape[1], cube.shape[2]
    collapsed_image = np.nansum(cube, axis=0)

    fig, (ax_img, ax_spec) = plt.subplots(2, 1, figsize=(8, 6), gridspec_kw={"height_ratios": [1, 2]})
    img = ax_img.imshow(collapsed_image, origin='lower', cmap='viridis')
    ax_img.set_title("Click on a pixel to view spectrum")

    spec_line, = ax_spec.plot([], [], label='Data')
    model_line, = ax_spec.plot([], [], label='Model')
    ax_spec.set_xlabel("Wavelength (Ã…)")
    ax_spec.set_ylabel("Flux")
    ax_spec.legend()

    def onclick(event):
        if event.inaxes == ax_img:
            x, y = int(event.xdata), int(event.ydata)
            spectrum = cube[:, y, x]
            model = model_cube[:, y, x]
            spec_line.set_data(wavelength, spectrum)
            model_line.set_data(wavelength, model)
            ax_spec.set_xlim(wavelength[0], wavelength[-1])
            ax_spec.set_ylim(np.nanmin(spectrum)*1.1, np.nanmax(spectrum)*1.1)
            fig.canvas.draw_idle()

    fig.canvas.mpl_connect('button_press_event', onclick)
    plt.tight_layout()
    plt.show()
